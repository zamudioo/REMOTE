<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Remoto Smart</title>
  <!-- Ajuste para m√≥vil -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,500&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body {
      font-family:'Roboto',sans-serif;
      background:#000;
      color:#fff;
      display:flex;
      justify-content:center;
      align-items:center;
      height:100vh;
      overflow:hidden;
      padding-top:env(safe-area-inset-top);
    }
    .remote-container {
      position:relative;
      width:95%; max-width:400px;
      height:95%; max-height:850px;
      background:linear-gradient(180deg,#2c2c2c,#1a1a1a);
      border-radius:30px;
      box-shadow:0 8px 20px rgba(0,0,0,0.7);
      display:flex; flex-direction:column;
      padding:15px;
    }
    .control-row { display:flex; justify-content:space-around; align-items:center; margin-bottom:10px; }
    .side-column { display:flex; flex-direction:column; align-items:center; gap:10px; }
    .round-btn, .mic-btn {
      background:#444; border:none; color:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      transition:background .3s,transform .2s;
      cursor:pointer;
    }
    .round-btn { border-radius:50%; width:50px; height:50px; font-size:1.4em; }
    .mic-btn   { border-radius:50%; width:60px; height:60px; font-size:1.6em; }
    .round-btn:hover, .mic-btn:hover { background:#666; transform:scale(1.1); }
    .trackpad-container { flex:1; display:flex; flex-direction:column; align-items:center; margin-bottom:10px; }
    .trackpad { flex:1; width:90%; max-width:300px; background:#111; border:2px dashed #555;
                border-radius:12px; touch-action:none; user-select:none; margin-bottom:10px;
                position:relative; }
    .click-buttons { display:flex; justify-content:center; gap:20px; margin-top:5px; }
    .click-btn {
      background:#2980b9; border:none; border-radius:30px;
      padding:10px 20px; font-size:1.1em; color:#fff;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      transition:background .3s,transform .2s;
      cursor:pointer;
    }
    .click-btn:hover { background:#1f6391; transform:scale(1.05); }
    .toggle-keyboard-btn {
      position:absolute; bottom:10px; right:10px;
      background:#2980b9; border:none; border-radius:30px;
      width:60px; height:60px; color:#fff; font-size:1.6em;
      box-shadow:0 4px 10px rgba(0,0,0,0.5);
      transition:transform .2s,background .3s;
      cursor:pointer;
    }
    .toggle-keyboard-btn:hover { background:#1f6391; transform:scale(1.1); }
    /* Keyboard overlay */
    .keyboard-overlay {
      position:absolute; left:0; bottom:-60%; width:100%; height:40%;
      background:#222; border-top-left-radius:30px; border-top-right-radius:30px;
      box-shadow:0 -5px 15px rgba(0,0,0,0.8); transition:bottom .4s;
      display:flex; flex-direction:column; overflow:hidden;
    }
    .keyboard-overlay.open { bottom:0; }
    .overlay-header {
      display:flex; justify-content:space-between; align-items:center;
      padding:10px 15px; background:#333;
    }
    .overlay-header .title { color:#fff; font-weight:500; }
    .overlay-header .close-btn {
      background:none; border:none; color:#ccc; font-size:1.5em;
      cursor:pointer; transition:color .2s;
    }
    .overlay-header .close-btn:hover { color:#fff; }
    .tabs { display:flex; border-bottom:1px solid #444; }
    .tab-btn {
      flex:1; text-align:center; padding:8px 0; color:#aaa;
      cursor:pointer; transition:background .2s,color .2s;
    }
    .tab-btn.active { background:#444; color:#fff; }
    .keyboard-section { flex:1; display:none; overflow:auto; padding:10px; }
    .keyboard-section.active {
      display:grid; grid-template-columns:repeat(auto-fit,minmax(40px,1fr)); grid-gap:5px;
    }
    .key {
      background:#444; border:none; border-radius:5px; padding:0px;
      cursor:pointer; transition:background .3s,transform .2s;
      color:#ecf0f1; text-align:center; font-size:1em;
    }
    .key:hover { background:#666; transform:scale(1.05); }
    .wide { grid-column:span 2; }
    .space { grid-column:span 6; }
  </style>
</head>
<body>
  <div class="remote-container">
    <div class="control-row">
      <div class="side-column">
        <button class="round-btn" onclick="sendCommand('volume','up')">+</button>
        <button class="round-btn" onclick="sendCommand('volume','mute')">üîá</button>
        <button class="round-btn" onclick="sendCommand('volume','down')">-</button>
      </div>
      <div class="side-column">
        <button class="mic-btn" onclick="alert('Mic pendiente')">üé§</button>
      </div>
      <div class="side-column">
        <button class="round-btn" onclick="sendCommand('media','prev')">‚èÆÔ∏è</button>
        <button class="round-btn" onclick="sendCommand('media','play_pause')">‚èØÔ∏è</button>
        <button class="round-btn" onclick="sendCommand('media','next')">‚è≠Ô∏è</button>
      </div>
    </div>

    <div class="trackpad-container">
      <div id="trackpad" class="trackpad"></div>
      <div class="click-buttons">
        <button id="left-btn" class="click-btn">Left</button>
        <button id="right-btn" class="click-btn" onclick="socket.emit('mouse_click',{button:'right'})">Right</button>
      </div>
    </div>

    <button class="toggle-keyboard-btn" onclick="toggleKeyboard()">‚å®Ô∏è</button>

    <div id="keyboardOverlay" class="keyboard-overlay">
      <div class="overlay-header">
        <div class="title">Teclado</div>
        <button class="close-btn" onclick="toggleKeyboard()">‚úï</button>
      </div>
      <div class="tabs">
        <div class="tab-btn active" data-target="main">abc</div>
        <div class="tab-btn" data-target="symbols">S√≠mbolos</div>
        <div class="tab-btn" data-target="special">Esp</div>
      </div>
      <div id="main" class="keyboard-section active">
        <!-- Secci√≥n principal: n√∫meros y letras -->
        <button class="key" onclick="sendKey('1')">1</button>
        <button class="key" onclick="sendKey('2')">2</button>
        <button class="key" onclick="sendKey('3')">3</button>
        <button class="key" onclick="sendKey('4')">4</button>
        <button class="key" onclick="sendKey('5')">5</button>
        <button class="key" onclick="sendKey('6')">6</button>
        <button class="key" onclick="sendKey('7')">7</button>
        <button class="key" onclick="sendKey('8')">8</button>
        <button class="key" onclick="sendKey('9')">9</button>
        <button class="key" onclick="sendKey('0')">0</button>
        <button class="key" onclick="sendKey('A')">A</button>
        <button class="key" onclick="sendKey('B')">B</button>
        <button class="key" onclick="sendKey('C')">C</button>
        <button class="key" onclick="sendKey('D')">D</button>
        <button class="key" onclick="sendKey('E')">E</button>
        <button class="key" onclick="sendKey('F')">F</button>
        <button class="key" onclick="sendKey('G')">G</button>
        <button class="key" onclick="sendKey('H')">H</button>
        <button class="key" onclick="sendKey('I')">I</button>
        <button class="key" onclick="sendKey('J')">J</button>
        <button class="key" onclick="sendKey('K')">K</button>
        <button class="key" onclick="sendKey('L')">L</button>
        <button class="key" onclick="sendKey('M')">M</button>
        <button class="key" onclick="sendKey('N')">N</button>
        <button class="key" onclick="sendKey('O')">O</button>
        <button class="key" onclick="sendKey('P')">P</button>
        <button class="key" onclick="sendKey('Q')">Q</button>
        <button class="key" onclick="sendKey('R')">R</button>
        <button class="key" onclick="sendKey('S')">S</button>
        <button class="key" onclick="sendKey('T')">T</button>
        <button class="key" onclick="sendKey('U')">U</button>
        <button class="key" onclick="sendKey('V')">V</button>
        <button class="key" onclick="sendKey('W')">W</button>
        <button class="key" onclick="sendKey('X')">X</button>
        <button class="key" onclick="sendKey('Y')">Y</button>
        <button class="key" onclick="sendKey('Z')">Z</button>
        <button class="wide key" onclick="sendKey('Backspace')">‚Üê</button>
        <button class="key wide" onclick="sendKey('Shift')">‚áß</button>
        <button class="space key" onclick="sendKey(' ')">____</button>
        <button class="wide key" onclick="sendKey('Enter')">‚Üµ</button>
      </div>
      <div id="symbols" class="keyboard-section">
        <!-- S√≠mbolos -->
        <button class="key" onclick="sendKey('!')">!</button>
        <button class="key" onclick="sendKey('@')">@</button>
        <button class="key" onclick="sendKey('#')">#</button>
        <button class="key" onclick="sendKey('$')">$</button>
        <button class="key" onclick="sendKey('%')">%</button>
        <button class="key" onclick="sendKey('^')">^</button>
        <button class="key" onclick="sendKey('&')">&</button>
        <button class="key" onclick="sendKey('(')">(</button>
        <button class="key" onclick="sendKey(')')">)</button>
        <button class="wide key" onclick="sendKey('Backspace')">‚Üê</button>
        <button class="key wide" onclick="sendKey('Shift')">‚áß</button>
        <button class="space key" onclick="sendKey(' ')">____</button>
        <button class="wide key" onclick="sendKey('Enter')">‚Üµ</button>
      </div>
      <div id="accented" class="keyboard-section">

      </div>
      <div id="special" class="keyboard-section">
        <!-- Fn y flechas -->
        <button class="key" onclick="sendKey('Esc')">Esc</button>
        <button class="key" onclick="sendKey('ArrowUp')">‚Üë</button>
        <button class="key" onclick="sendKey('ArrowLeft')">‚Üê</button>
        <button class="key" onclick="sendKey('ArrowDown')">‚Üì</button>
        <button class="key" onclick="sendKey('ArrowRight')">‚Üí</button>
      </div>
    </div>
  </div>

  <script>
    const socket = io();
    function sendCommand(type,data){ socket.emit(type,data); }
    function sendKey(key){ socket.emit('keyboard',key); }

    // Manejo del trackpad
    let leftButtonDown = false;
    const leftBtn = document.getElementById('left-btn');
    leftBtn.addEventListener('pointerdown', e => {
      leftButtonDown = true;
      socket.emit('mouse_down', { button: 'left' });
    });
    leftBtn.addEventListener('pointerup', e => {
      leftButtonDown = false;
      socket.emit('mouse_up', { button: 'left' });
    });

    const trackpad = document.getElementById('trackpad');
    let pointers = new Map();
    let initialTouch = null;
    let didMove = false;
    let twoFingerTap = false, gestureStart = 0, initialPositions = new Map();
    let lastScrollY = 0;
    const MOVE_THRESHOLD = 5;
    const TAP_TIME = 200;

    trackpad.addEventListener('pointerdown', e => {
      pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });
      trackpad.setPointerCapture(e.pointerId);

      if (pointers.size === 1) {
        initialTouch = { x: e.clientX, y: e.clientY };
        didMove = false;
      } else if (pointers.size === 2) {
        twoFingerTap = true;
        gestureStart = Date.now();
        initialPositions = new Map(pointers);
        const ys = Array.from(pointers.values()).map(p => p.y);
        lastScrollY = (ys[0] + ys[1]) / 2;
      }
    });

    trackpad.addEventListener('pointermove', e => {
      if (!pointers.has(e.pointerId)) return;
      pointers.set(e.pointerId, { x: e.clientX, y: e.clientY });

      if (pointers.size === 2) {
        if (twoFingerTap) {
          const init = initialPositions.get(e.pointerId);
          if (Math.hypot(e.clientX - init.x, e.clientY - init.y) > MOVE_THRESHOLD) {
            twoFingerTap = false;
          }
        }
        const ys = Array.from(pointers.values()).map(p => p.y);
        const avgY = (ys[0] + ys[1]) / 2;
        const dy = avgY - lastScrollY;
        lastScrollY = avgY;
        socket.emit('mouse_scroll', { dy: -dy });
      } else if (pointers.size === 1) {
        if (initialTouch) {
          const dx = e.clientX - initialTouch.x;
          const dy = e.clientY - initialTouch.y;
          if (Math.hypot(dx, dy) > MOVE_THRESHOLD) {
            didMove = true;
          }
        }
        socket.emit('mouse_move', { dx: e.movementX, dy: e.movementY });
      }
    });

    trackpad.addEventListener('pointerup', e => {
      pointers.delete(e.pointerId);
      trackpad.releasePointerCapture(e.pointerId);

      if (pointers.size === 0) {
        if (!leftButtonDown && !didMove) {
          socket.emit('mouse_click', { button: 'left' });
        }
        if (twoFingerTap && (Date.now() - gestureStart) < TAP_TIME) {
          socket.emit('mouse_click', { button: 'right' });
        }
        initialTouch = null;
        didMove = false;
        twoFingerTap = false;
      }
    });

    trackpad.addEventListener('pointercancel', e => {
      pointers.clear();
      trackpad.releasePointerCapture(e.pointerId);
      initialTouch = null;
      didMove = false;
      twoFingerTap = false;
    });

    // Funci√≥n para abrir o cerrar el panel de teclado
    const keyboardOverlay = document.getElementById('keyboardOverlay');
    function toggleKeyboard() { keyboardOverlay.classList.toggle('open'); }

    document.querySelectorAll('.tab-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        document.querySelectorAll('.keyboard-section').forEach(sec => sec.classList.remove('active'));
        document.getElementById(btn.dataset.target).classList.add('active');
      });
    });
  </script>
</body>
</html>
